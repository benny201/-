# 运输层
运输层向应用层提供通信服务
主机协议栈才有TCP，服务器下只有下三层

## 为什么需要运输层？
* 从IP层来说，通信的两端是两个主机，但是这样说法不清楚，应该是主机中的进程和另一个主机中的进程通信。
* IP层只把packet送到目的主机，但是，这个分组海停留在主机的网络层，而没有交付到应用进程里。
* 所以IP层是位主机之间提供逻辑通信，运输层是为应用层直接提供端对端的逻辑通信。
* 为了完成多个进程同时通信：复用和分用

## 协议端口号
协议端口号解决的问题：进程的创建和撤销是动态的，通信一方无法识别对方机器上的进程。
运输层只要送到端口，剩下TCP交付。
这个端口只是`软件端口`（协议进程与运输实体进行层间交互地址）, 和router上的`硬件端口`（不同设备交接的接口）不同。

### 大小
TCP/IP运输层提供一个16位的标志的端口，有65535个端口。不同计算机中的端口没有关联性。

### 熟知端口号(0-1023)
指派了一些重要的应用程序。
DNS: 53, HTTP:80, FTP:21


## UDP 用户数据报协议
主要是在IP数据报服务加了：复用，分用，差错检测功能。
特点：
* 无连接
* 尽最大努力交付
* 面向报文
```Java
对应用层交付的报文，保留报文的边界，只加首部后交付IP层。上交应用层时也是原封不动。
太短：IP层报文首都相对长度太长。
太长：IP要分片
```
* 没有拥堵控制
```Java
适合要求恒定速率发送数据，允许丢失一部分数据的应用。
但是如果网络发生拥堵，可能引起大问题。
```
* UDP可以N对N通信
* UDP首部开销小。
```
只有8字节，TCP有20字节
```

### 首部格式
* 源端口 ：需要回信时选用
* 目的端口
* 长度：最小为8字节
* 检验和
UDP计算检验和时，还会在UDP数据包头加一个12字节的伪首部，只用于计算校验和。
IP数据报的检验和只检验IP数据报的首部，但是UDP检验和会把首部和数据部分一起检验。
运算过程：`按二进制反码求和，将得出的结果求反码`

### 交付
如果发现收到的目的端口号不正确，会丢弃报文，并由ICMP发送一个`端口不可达`报文给发送方。





